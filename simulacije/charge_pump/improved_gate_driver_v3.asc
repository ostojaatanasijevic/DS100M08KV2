Version 4
SHEET 1 11460 3748
WIRE 2608 16 1600 16
WIRE 2752 16 2752 -112
WIRE 2752 16 2608 16
WIRE 2608 144 2608 16
WIRE 2752 144 2752 16
WIRE 1600 336 1600 16
WIRE 1680 336 1600 336
WIRE 1808 336 1680 336
WIRE 2512 336 2400 336
WIRE 2608 336 2608 224
WIRE 2608 336 2512 336
WIRE 2752 336 2752 208
WIRE 2752 336 2608 336
WIRE 1808 368 1808 336
WIRE 2400 368 2400 336
WIRE 4128 368 4032 368
WIRE 4256 368 4128 368
WIRE 1920 384 1856 384
WIRE 1952 384 1920 384
WIRE 2096 384 2064 384
WIRE 2160 384 2096 384
WIRE 2304 384 2224 384
WIRE 2352 384 2304 384
WIRE 3264 384 3168 384
WIRE 3392 384 3264 384
WIRE 4032 416 4032 368
WIRE 2304 432 2304 384
WIRE 3168 432 3168 384
WIRE 2752 496 2752 336
WIRE 2304 528 2304 496
WIRE 3168 528 3168 512
WIRE 4032 528 4032 496
WIRE 4128 560 4032 560
WIRE 4256 560 4128 560
WIRE 1808 576 1808 464
WIRE 2064 576 1808 576
WIRE 2400 576 2400 464
WIRE 2400 576 2128 576
WIRE 1600 592 1600 336
WIRE 2608 592 2608 336
WIRE 3248 608 3168 608
WIRE 3328 608 3248 608
WIRE 4032 608 4032 560
WIRE 1808 656 1808 576
WIRE 2400 656 2400 576
WIRE 3168 656 3168 608
WIRE 4032 704 4032 688
WIRE 1920 736 1856 736
WIRE 1952 736 1920 736
WIRE 2096 736 2064 736
WIRE 2160 736 2096 736
WIRE 2304 736 2224 736
WIRE 2352 736 2304 736
WIRE 3168 752 3168 736
WIRE 2304 784 2304 736
WIRE 1168 864 1104 864
WIRE 1344 864 1280 864
WIRE 1424 864 1344 864
WIRE 1600 944 1600 672
WIRE 1808 944 1808 752
WIRE 1808 944 1600 944
WIRE 2304 944 2304 848
WIRE 2304 944 1808 944
WIRE 2400 944 2400 752
WIRE 2400 944 2304 944
WIRE 2608 944 2608 656
WIRE 2608 944 2400 944
WIRE 1104 1040 1104 864
WIRE 1168 1040 1104 1040
WIRE 1344 1040 1280 1040
WIRE 1424 1040 1344 1040
WIRE 944 1216 848 1216
WIRE 1104 1216 1104 1040
WIRE 1104 1216 1024 1216
WIRE 1168 1216 1104 1216
WIRE 1344 1216 1280 1216
WIRE 1424 1216 1344 1216
WIRE 848 1312 848 1216
WIRE 960 1312 848 1312
WIRE 1104 1312 1104 1216
WIRE 1104 1312 1024 1312
WIRE 1104 1408 1104 1312
WIRE 1104 1520 1104 1472
WIRE 1168 1664 1104 1664
WIRE 1360 1664 1280 1664
WIRE 1456 1664 1360 1664
WIRE 848 1824 848 1312
WIRE 944 1824 848 1824
WIRE 1104 1824 1104 1664
WIRE 1104 1824 1024 1824
WIRE 1168 1824 1104 1824
WIRE 1360 1824 1280 1824
WIRE 1456 1824 1360 1824
WIRE 848 1920 848 1824
WIRE 944 1920 848 1920
WIRE 1104 1920 1104 1824
WIRE 1104 1920 1008 1920
WIRE 848 2016 848 1920
WIRE 1104 2016 1104 1920
WIRE 848 2128 848 2096
WIRE 1104 2128 1104 2080
FLAG 2304 944 0
FLAG 1920 736 G1
FLAG 1920 384 G2
FLAG 2304 528 0
FLAG 2096 736 G2
FLAG 2096 384 G1
FLAG 3168 528 0
FLAG 3168 752 0
FLAG 3264 384 output_power
FLAG 3248 608 input_power
FLAG 4032 528 0
FLAG 4128 368 efficiency
FLAG 4032 704 0
FLAG 4128 560 losses
FLAG 1680 336 vin
FLAG 2512 336 vout
FLAG 848 2128 0
FLAG 1104 1520 0
FLAG 1104 2128 0
FLAG 1168 1856 0
FLAG 1168 1248 0
FLAG 1168 1184 vin
FLAG 1168 1792 vin
FLAG 1360 1824 G1
FLAG 1344 1216 G2
FLAG 1168 1696 0
FLAG 1168 1632 vin
FLAG 1360 1664 G1
FLAG 1168 1072 0
FLAG 1168 1008 vin
FLAG 1344 1040 G2
FLAG 1168 896 0
FLAG 1168 832 vin
FLAG 1344 864 G2
SYMBOL cap 2128 560 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value {Cf}
SYMBOL cap 2624 656 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C2
SYMATTR Value {Cf}
SYMBOL cap 2160 720 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL schottky 2320 784 M0
SYMATTR InstName D1
SYMATTR Value RB480K
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage 1600 576 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vbat}
SYMBOL res 2592 128 R0
SYMATTR InstName R2
SYMATTR Value 30
SYMBOL cap 2160 368 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C9
SYMATTR Value 100n
SYMBOL schottky 2320 432 M0
SYMATTR InstName D2
SYMATTR Value RB480K
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL pmos 1856 464 R180
SYMATTR InstName M1
SYMATTR Value AO6407
SYMBOL nmos 1856 656 M0
SYMATTR InstName M2
SYMATTR Value AO4630_N
SYMBOL pmos 2352 656 R0
SYMATTR InstName M3
SYMATTR Value AO6407
SYMBOL nmos 2352 464 M180
SYMATTR InstName M4
SYMATTR Value AO4630_N
SYMBOL bv 3168 416 R0
SYMATTR InstName B1
SYMATTR Value V= if(time >  start_time, idt(V(vin, vout)*I(R2))/(time - start_time),0)
SYMBOL bv 3168 640 R0
SYMATTR InstName B2
SYMATTR Value V=if(time > start_time, -idt(V(vin)*I(V2)) / (time - start_time),0)
SYMBOL bv 4032 592 R0
SYMATTR InstName B3
SYMATTR Value V=  V(input_power) - V(output_power)
SYMBOL bv 4032 400 R0
SYMATTR InstName B4
SYMATTR Value V= min(max(V(output_power) / V(input_power),0), 1)
SYMBOL voltage 848 2000 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -469 194 Left 2
SYMATTR Value PULSE(0 4 {1 / fsw / 2} 10n 10n {d / fsw} {1 / fsw})
SYMATTR InstName V1
SYMBOL res 1040 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL cap 1088 1408 R0
SYMATTR InstName C4
SYMATTR Value 100p
SYMBOL diode 1024 1296 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 1040 1808 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL diode 944 1936 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL cap 1088 2016 R0
SYMATTR InstName C6
SYMATTR Value 100p
SYMBOL SN74HC14 1216 1808 R0
SYMATTR InstName U1
SYMBOL SN74HC14 1216 1200 R0
SYMATTR InstName U2
SYMBOL SN74HC14 1216 1648 R0
SYMATTR InstName U3
SYMBOL SN74HC14 1216 1024 R0
SYMATTR InstName U4
SYMBOL SN74HC14 1216 848 R0
SYMATTR InstName U5
SYMBOL cap 2768 208 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C5
SYMATTR Value 100µ
TEXT -1000 880 Left 2 !.param fsw 50k
TEXT -1000 912 Left 2 !.param d = 0.5
TEXT -1000 848 Left 2 !.param Cf = 10u
TEXT -1000 944 Left 2 !.tran 5m
TEXT -1536 112 Left 2 !.lib AO3400.mod
TEXT -1184 528 Left 2 !.param Vbat 4.2
TEXT 3400 408 Left 2 !.param start_time = 2m
TEXT -1008 1032 Left 6 ;300 kHz peak eff: 98%
