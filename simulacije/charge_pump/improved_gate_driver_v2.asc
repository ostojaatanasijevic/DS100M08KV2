Version 4
SHEET 1 11460 3748
WIRE 2608 16 1600 16
WIRE 2608 144 2608 16
WIRE 1600 336 1600 16
WIRE 1680 336 1600 336
WIRE 1808 336 1680 336
WIRE 2512 336 2400 336
WIRE 2608 336 2608 224
WIRE 2608 336 2512 336
WIRE 1808 368 1808 336
WIRE 2400 368 2400 336
WIRE 1920 384 1856 384
WIRE 1952 384 1920 384
WIRE 2096 384 2064 384
WIRE 2160 384 2096 384
WIRE 2304 384 2224 384
WIRE 2352 384 2304 384
WIRE 3712 384 3616 384
WIRE 3840 384 3712 384
WIRE 2848 400 2752 400
WIRE 2976 400 2848 400
WIRE 2304 432 2304 384
WIRE 3616 432 3616 384
WIRE 2752 448 2752 400
WIRE 688 464 608 464
WIRE 864 464 768 464
WIRE 912 464 864 464
WIRE 608 496 608 464
WIRE 560 512 528 512
WIRE 464 528 352 528
WIRE 2304 528 2304 496
WIRE 464 544 384 544
WIRE 2752 544 2752 528
WIRE 3616 544 3616 512
WIRE 1808 576 1808 464
WIRE 2064 576 1808 576
WIRE 2400 576 2400 464
WIRE 2400 576 2128 576
WIRE 3712 576 3616 576
WIRE 3840 576 3712 576
WIRE 480 592 480 560
WIRE 1600 592 1600 336
WIRE 2608 592 2608 336
WIRE 688 624 608 624
WIRE 864 624 768 624
WIRE 912 624 864 624
WIRE 2832 624 2752 624
WIRE 2912 624 2832 624
WIRE 3616 624 3616 576
WIRE 384 656 384 544
WIRE 384 656 96 656
WIRE 464 656 384 656
WIRE 608 656 608 624
WIRE 1808 656 1808 576
WIRE 2400 656 2400 576
WIRE 560 672 528 672
WIRE 2752 672 2752 624
WIRE 96 704 96 656
WIRE 192 704 96 704
WIRE 352 704 352 528
WIRE 352 704 272 704
WIRE 464 704 352 704
WIRE 3616 720 3616 704
WIRE 1920 736 1856 736
WIRE 1952 736 1920 736
WIRE 2096 736 2064 736
WIRE 2160 736 2096 736
WIRE 2304 736 2224 736
WIRE 2352 736 2304 736
WIRE 480 768 480 720
WIRE 2752 768 2752 752
WIRE 2304 784 2304 736
WIRE 96 800 96 704
WIRE 352 800 352 704
WIRE 96 912 96 880
WIRE 352 912 352 864
WIRE 1600 944 1600 672
WIRE 1808 944 1808 752
WIRE 1808 944 1600 944
WIRE 2304 944 2304 848
WIRE 2304 944 1808 944
WIRE 2400 944 2400 752
WIRE 2400 944 2304 944
WIRE 2608 944 2608 656
WIRE 2608 944 2400 944
WIRE 1120 1184 1088 1184
WIRE 1168 1184 1120 1184
WIRE 944 1216 848 1216
WIRE 1104 1216 1024 1216
WIRE 1168 1216 1104 1216
WIRE 1424 1216 1280 1216
WIRE 1440 1216 1424 1216
WIRE 848 1312 848 1216
WIRE 960 1312 848 1312
WIRE 1104 1312 1104 1216
WIRE 1104 1312 1024 1312
WIRE 1104 1408 1104 1312
WIRE 1104 1520 1104 1472
WIRE 1120 1568 1088 1568
WIRE 1168 1568 1120 1568
WIRE 848 1600 848 1312
WIRE 944 1600 848 1600
WIRE 1104 1600 1024 1600
WIRE 1168 1600 1104 1600
WIRE 1408 1600 1280 1600
WIRE 1456 1600 1408 1600
WIRE 848 1696 848 1600
WIRE 944 1696 848 1696
WIRE 1104 1696 1104 1600
WIRE 1104 1696 1008 1696
WIRE 848 1792 848 1696
WIRE 1104 1792 1104 1696
WIRE 848 1904 848 1872
WIRE 1104 1904 1104 1856
FLAG 2304 944 0
FLAG 96 912 0
FLAG 352 912 0
FLAG 480 768 0
FLAG 480 592 0
FLAG 560 560 0
FLAG 608 576 0
FLAG 560 720 0
FLAG 608 736 0
FLAG 864 624 G1
FLAG 864 464 G2
FLAG 1920 736 G1
FLAG 1920 384 G2
FLAG 2304 528 0
FLAG 2096 736 G2
FLAG 2096 384 G1
FLAG 2752 544 0
FLAG 2752 768 0
FLAG 2848 400 output_power
FLAG 2832 624 input_power
FLAG 3616 544 0
FLAG 3712 384 efficiency
FLAG 3616 720 0
FLAG 3712 576 losses
FLAG 1680 336 vin
FLAG 2512 336 vout
FLAG 848 1904 0
FLAG 1104 1520 0
FLAG 1104 1904 0
FLAG 1168 1632 0
FLAG 1168 1248 0
FLAG 1120 1184 vin
FLAG 1120 1568 vin
FLAG 1408 1600 G1
FLAG 1424 1216 G2
SYMBOL cap 2128 560 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value {Cf}
SYMBOL cap 2624 656 R180
WINDOW 0 24 56 Left 2
WINDOW 3 24 8 Left 2
SYMATTR InstName C2
SYMATTR Value {Cf}
SYMBOL cap 2160 720 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 100n
SYMBOL schottky 2320 784 M0
SYMATTR InstName D1
SYMATTR Value RB480K
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL voltage 1600 576 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V2
SYMATTR Value {Vbat}
SYMBOL res 2592 128 R0
SYMATTR InstName R2
SYMATTR Value 30
SYMBOL Digital\\and 496 624 R0
SYMATTR InstName A1
SYMBOL voltage 96 784 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -469 194 Left 2
SYMATTR Value PULSE(0 1 {1 / fsw / 2} 10n 10n {d / fsw} {1 / fsw})
SYMATTR InstName V3
SYMBOL res 288 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 1k
SYMBOL cap 336 800 R0
SYMATTR InstName C5
SYMATTR Value 510p
SYMBOL Digital\\or 496 464 R0
SYMATTR InstName A2
SYMBOL e 608 480 R0
SYMATTR InstName E1
SYMATTR Value 5
SYMBOL e 608 640 R0
SYMATTR InstName E2
SYMATTR Value 5
SYMBOL cap 2160 368 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C9
SYMATTR Value 100n
SYMBOL schottky 2320 432 M0
SYMATTR InstName D2
SYMATTR Value RB480K
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL res 784 448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 50
SYMBOL res 784 608 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 50
SYMBOL pmos 1856 464 R180
SYMATTR InstName M1
SYMATTR Value AO6407
SYMBOL nmos 1856 656 M0
SYMATTR InstName M2
SYMATTR Value AO4630_N
SYMBOL pmos 2352 656 R0
SYMATTR InstName M3
SYMATTR Value AO6407
SYMBOL nmos 2352 464 M180
SYMATTR InstName M4
SYMATTR Value AO4630_N
SYMBOL bv 2752 432 R0
SYMATTR InstName B1
SYMATTR Value V= if(time >  start_time, idt(V(vin, vout)*I(R2))/(time - start_time),0)
SYMBOL bv 2752 656 R0
SYMATTR InstName B2
SYMATTR Value V=if(time > start_time, -idt(V(vin)*I(V2)) / (time - start_time),0)
SYMBOL bv 3616 608 R0
SYMATTR InstName B3
SYMATTR Value V=  V(input_power) - V(output_power)
SYMBOL bv 3616 416 R0
SYMATTR InstName B4
SYMATTR Value V= min(max(V(output_power) / V(input_power),0), 1)
SYMBOL voltage 848 1776 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 3 -469 194 Left 2
SYMATTR Value PULSE(0 4 {1 / fsw / 2} 10n 10n {d / fsw} {1 / fsw})
SYMATTR InstName V1
SYMBOL res 1040 1200 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 1k
SYMBOL cap 1088 1408 R0
SYMATTR InstName C4
SYMATTR Value 100p
SYMBOL diode 1024 1296 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName D3
SYMATTR Value 1N4148
SYMBOL res 1040 1584 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 1k
SYMBOL diode 944 1712 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D4
SYMATTR Value 1N4148
SYMBOL cap 1088 1792 R0
SYMATTR InstName C6
SYMATTR Value 510p
SYMBOL SN74HC14 1216 1584 R0
SYMATTR InstName U1
SYMBOL SN74HC14 1216 1200 R0
SYMATTR InstName U2
TEXT -1000 880 Left 2 !.param fsw 300k
TEXT -1000 912 Left 2 !.param d = 0.5
TEXT -1000 848 Left 2 !.param Cf = 10u
TEXT -1000 944 Left 2 !.tran 5m
TEXT -1536 112 Left 2 !.lib AO3400.mod
TEXT -1184 528 Left 2 !.param Vbat 4.2
TEXT 2984 424 Left 2 !.param start_time = 2m
TEXT -1008 1032 Left 6 ;300 kHz peak eff: 98%
